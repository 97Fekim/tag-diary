<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/basic :: setContent(~{this::content})}">
    <th:block th:fragment="content">

        <!-- Page Header-->
        <header class="masthead" style="padding-top: 5rem; padding-bottom: 5rem; background-image: url('/assets/img/beach.jpg')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">

                    </div>
                </div>
            </div>
        </header>

        <!-- Page content-->
        <div class="container mt-5">
            <div class="row">
                <!-- Side widgets-->
                <div class="col-lg-4">
                    <!-- Categories widget-->
                    <div class="card mb-4">
                        <div class="card-header">태그1</div>
                        <div class="card-body">
                            <div class="row">
                                <div id="tagContainer" class="post-preview">

                                    <th:block th:each="tagDTO : ${tagDTOList}">
                                        <button th:id="${tagDTO.tno}" class="big-tag-box in-tag-container" th:style="|background-color: ${tagDTO.color}|" th:text="${tagDTO.name}"></button>
                                    </th:block>

                                </div>
                            </div>
                        </div>
                        <div class="card-header">태그2</div>
                        <div class="card-body">
                            <div class="row">
                                <div id="tagContainer2" class="post-preview">

                                    <th:block th:each="tagDTO : ${tagDTOList}">

                                        <button th:id="${tagDTO.tno}" class="big-tag-box in-tag-container" th:style="|background-color: ${tagDTO.color}|" th:text="${tagDTO.name}">
                                        </button>

                                    </th:block>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Side widget-->
                    <div class="card mb-4">
                        <div class="card-header">Side Widget</div>
                        <div class="card-body">You can put anything you want inside of these side widgets. They are easy to use, and feature the Bootstrap 5 card component!</div>
                    </div>
                </div>

                <div class="col-lg-8">
                    <div class="card-header">글 등록</div>
                    <div class="card-body">
                        <div class="row">
                            <h1 class="fw-bolder mb-1">
                                <input placeholder="제목을 입력하세요" style="border: 0; outline: 0">
                            </h1>

                            <div id="diaryContainer" class="post-preview tag-container">

                            </div>
                        </div>
                    </div>
                    <button id="registerBtn" style="float: right">등록</button>
                </div>
            </div>

        </div>

        <script>
            /* tag 공간과 diary 공간 */
            const tagContainer = document.getElementById("tagContainer");
            const diaryContainer = document.getElementById("diaryContainer");

            /* tagContainer => diaryContainer */
            $(document).on("click",".big-tag-box",function() {

                /* 헤더 만들기 */
                let addHeader = document.createElement('div');
                addHeader.innerHTML = this.innerHTML;
                addHeader.setAttribute("id", "header-id-" + this.getAttribute("id"));
                addHeader.setAttribute("class", "card-header tag-header");
                addHeader.setAttribute("style", this.getAttribute('style'));
                addHeader.setAttribute("ros", 3);

                /* 제거 버튼 만들기 */
                let removeBtn = document.createElement('button');
                removeBtn.innerHTML = 'x';
                removeBtn.setAttribute("style", this.getAttribute('style') + "; color : red; border:0; outline:0; float:right");
                removeBtn.setAttribute("class", "removeBtn");
                removeBtn.setAttribute("id", "removeBtn" + this.getAttribute("id"));

                addHeader.appendChild(removeBtn);

                /* text 적힐 곳 만들기 */
                let addTextarea = document.createElement('textarea');
                addTextarea.setAttribute("style", "border:0; ouline:0")
                addTextarea.setAttribute("id", "textarea-id-" + this.getAttribute("id"));
                addTextarea.setAttribute("class", "form-control content-textarea");
                addTextarea.setAttribute("placeholder", "내용을 입력하세요");

                /* diaryContainer에 최종 추가 */
                diaryContainer.appendChild(addHeader);
                diaryContainer.appendChild(addTextarea);

                /* tagContainer에 있는 Tag 지우면서 끝 */
                tagContainer.removeChild(this);

            })


            /* 삭제 버튼 이벤트 처리
            * diaryContainer => tagContainer
            * */
            $(document).on("click",".removeBtn",function(){

                console.log(this);

                /* Tag의 인덱스만 추출 */
                var regex = /[^0-9]/g;
                var index = this.getAttribute("id").replace(regex, "");
                console.log(index);

                /* 태그 삭제 */
                var beRemovedTextArea = document.getElementById("textarea-id-"+index);
                var beRemovedHeader = document.getElementById("header-id-"+index);

                var tagText = beRemovedHeader.innerText;
                tagText = tagText.substring(0, tagText.length - 2);
                var tagColor = beRemovedHeader.getAttribute("style");

                diaryContainer.removeChild(beRemovedTextArea);
                diaryContainer.removeChild(beRemovedHeader);

                /* TODO : Tag Container에 다시 태그 집어넣기 */

                let reAddBtn = document.createElement('button');

                reAddBtn.setAttribute("id", index);
                reAddBtn.setAttribute("class", "big-tag-box in-tag-container");
                reAddBtn.setAttribute("style", tagColor);
                reAddBtn.innerText = tagText;

                tagContainer.appendChild(reAddBtn);

            });

            $(document).on("click", "#registerBtn", function (){
                console.log("register!!!");

                var tags = document.getElementsByClassName("tag-header");
                var contents = document.getElementsByClassName("content-textarea")

                var regex = /[^0-9]/g;

                for(var tno of tags){

                    var result = tno.getAttribute("id").replace(regex, "");
                    console.log(result);

                }

                for(var content of contents){

                    var result = content.value;
                    console.log(result);

                }

            })

        </script>

    </th:block>
</th:block>